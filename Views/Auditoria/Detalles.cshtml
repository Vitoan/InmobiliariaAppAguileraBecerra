@model InmobiliariaAppAguileraBecerra.Models.Auditoria

@{
    ViewData["Title"] = "Detalles de Auditoría";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-primary">
            <i class="bi bi-shield-check"></i> @ViewData["Title"]
        </h2>
        <a asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left-circle"></i> Volver
        </a>
    </div>

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title text-dark mb-3">
                <i class="bi bi-info-circle"></i> Información General
            </h5>

            <dl class="row">
                <dt class="col-sm-3" data-bs-toggle="tooltip" title="Identificador único de la auditoría">ID:</dt>
                <dd class="col-sm-9">@Model.Id</dd>

                <dt class="col-sm-3">Tabla:</dt>
                <dd class="col-sm-9">@Model.Tabla</dd>

                <dt class="col-sm-3">Operación:</dt>
                <dd class="col-sm-9">
                    @switch (Model.Operacion)
                    {
                        case "Alta":
                            <span class="badge bg-success">Alta</span>; break;
                        case "Modificación":
                            <span class="badge bg-warning text-dark">Modificación</span>; break;
                        case "Terminación":
                        case "Terminación Anticipada":
                            <span class="badge bg-danger">Terminación</span>; break;
                        case "Anulación":
                            <span class="badge bg-secondary">Anulación</span>; break;
                        default:
                            <span class="badge bg-info">@Model.Operacion</span>; break;
                    }
                </dd>

                <dt class="col-sm-3">Registro ID:</dt>
                <dd class="col-sm-9">@Model.RegistroId</dd>

                <dt class="col-sm-3">Fecha:</dt>
                <dd class="col-sm-9">@Model.Fecha.ToString("dd/MM/yyyy HH:mm:ss")</dd>

                <dt class="col-sm-3">Usuario:</dt>
                <dd class="col-sm-9">@Model.Usuario</dd>
            </dl>
        </div>
    </div>

    <div class="row">
        @if (!string.IsNullOrEmpty(Model.DatosAnteriores))
        {
            <div class="col-md-6 mb-4">
                <div class="card border-secondary shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-arrow-left-circle"></i> Datos Anteriores
                    </div>
                    <div class="card-body bg-light">
                        <pre class="json-view">@Html.Raw(Model.DatosAnteriores)</pre>
                    </div>
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.DatosNuevos))
        {
            <div class="@(string.IsNullOrEmpty(Model.DatosAnteriores) ? "col-md-12" : "col-md-6") mb-4">
                <div class="card border-success shadow-sm">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-arrow-right-circle"></i> Datos Nuevos
                    </div>
                    <div class="card-body bg-light">
                        <pre class="json-view">@Html.Raw(Model.DatosNuevos)</pre>
                    </div>
                </div>
            </div>
        }
    </div>

    @if (string.IsNullOrEmpty(Model.DatosAnteriores) && string.IsNullOrEmpty(Model.DatosNuevos))
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No hay datos disponibles para este registro.
        </div>
    }
</div>

<style>
    pre.json-view {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 10px;
        max-height: 400px;
        overflow-y: auto;
        font-size: 0.9rem;
        line-height: 1.3;
        border: 1px solid #e0e0e0;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    .card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
        transform: scale(1.01);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
    }
</style>

@section Scripts {
    <script>
        // Activa tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        tooltipTriggerList.map(function (el) { return new bootstrap.Tooltip(el) });

        // Formatea JSON si es válido
        document.querySelectorAll('.json-view').forEach(pre => {
            try {
                const json = JSON.parse(pre.textContent);
                pre.textContent = JSON.stringify(json, null, 2);
            } catch (e) { }
        });
    </script>
}
